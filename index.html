<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Visualizer</title>

<style>
:root{
  --bg:#0b0f1a;
  --card:#11162a;
  --neon:#00e5ff;
  --text:#e0f7ff;
  --border:rgba(0,229,255,.3);
}

[data-theme="light"]{
  --bg:#eef6ff;
  --card:#ffffff;
  --neon:#2979ff;
  --text:#0a1a2f;
  --border:#2979ff44;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,Arial,sans-serif;
  background:radial-gradient(circle at top,var(--bg),#000);
  color:var(--text);
}

.container{
  max-width:800px;
  margin:auto;
  padding:1rem;
}

h1,h2{
  text-align:center;
  color:var(--neon);
}

.card{
  background:linear-gradient(145deg,var(--card),#0a0f22);
  border:1px solid var(--border);
  border-radius:14px;
  padding:1rem;
  margin-bottom:1.2rem;
}

label,select,input{
  width:100%;
  margin:.4rem 0;
}

input,select{
  padding:.6rem;
  background:#050816;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:6px;
}

button{
  width:100%;
  padding:.6rem;
  margin-top:.6rem;
  background:var(--neon);
  color:#000;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

canvas{
  width:100%;
  max-width:320px;
  aspect-ratio:1/1;
  display:block;
  margin:1rem auto;
  background:#02030a;
  border:1px solid var(--border);
}

.footer{
  text-align:center;
  font-size:.75rem;
  opacity:.7;
}
</style>
</head>

<body data-theme="dark">
<div class="container">

<h1>Visualisasi Sudut & Trigonometri</h1>

<div class="card">
<label>Tema</label>
<select id="theme">
<option value="dark">Dark</option>
<option value="light">Light</option>
</select>

<label>Sudut (Â°)</label>
<input type="number" id="angle" value="0">

<canvas id="canvas" width="300" height="300"></canvas>

<p id="sinVal"></p>
<p id="cosVal"></p>
<p id="tanVal"></p>
</div>

<div class="card">
<h2>Kalkulasi Jarak</h2>

<input id="tinggiGunung" placeholder="Tinggi (m)">
<input id="sudutElevasi" placeholder="Sudut (Â°)">
<input id="jarakGunung" placeholder="Jarak (m)">

<button onclick="hitungJarak()">Hitung</button>
<p id="hasilJarak"></p>
</div>

<div class="card">
<h2>ğŸ“ Mode Ujian Trigonometri</h2>

<p id="ujianSoal"></p>
<input id="ujianJawaban" placeholder="Jawaban (âˆš3/2 atau 0.707)">

<button onclick="jawabUjian()">Submit</button>
<button onclick="mulaiUjian()">Mulai Ujian</button>

<p id="ujianInfo"></p>
<div id="ujianHasil"></div>
</div>

<div class="footer">Made by Dzkyy âš¡ Math Visualization</div>

</div>

<script>
/* =======================
   KARTESIUS & VISUAL
======================= */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const sinVal = document.getElementById("sinVal");
const cosVal = document.getElementById("cosVal");
const tanVal = document.getElementById("tanVal");
const angle = document.getElementById("angle");

const special = {
  0:["0","1","0"],
  30:["1/2","âˆš3/2","âˆš3/3"],
  45:["âˆš2/2","âˆš2/2","1"],
  60:["âˆš3/2","1/2","âˆš3"],
  90:["1","0","âˆ"]
};

// ğŸ”¹ fungsi nilai eksak lintas kuadran
function nilaiEksak(theta){
  const deg = ((theta % 360) + 360) % 360;

  let ref;
  if(deg <= 90) ref = deg;
  else if(deg <= 180) ref = 180 - deg;
  else if(deg <= 270) ref = deg - 180;
  else ref = 360 - deg;

  if(!special[ref]) return null;

  let [s, c, t] = special[ref];

  const sinNeg = deg > 180;
  const cosNeg = deg > 90 && deg < 270;

  if(s !== "0" && s !== "1" && sinNeg) s = "-" + s;
  if(c !== "0" && c !== "1" && cosNeg) c = "-" + c;

  if(t !== "0" && t !== "âˆ"){
    if((sinNeg && !cosNeg) || (!sinNeg && cosNeg)){
      t = "-" + t;
    }
  }

  return { sin:s, cos:c, tan:t };
}

function drawGrid(){
  ctx.strokeStyle="#233";
  for(let i=0;i<=300;i+=30){
    ctx.beginPath();
    ctx.moveTo(i,0); ctx.lineTo(i,300);
    ctx.moveTo(0,i); ctx.lineTo(300,i);
    ctx.stroke();
  }

  ctx.strokeStyle="#777";
  ctx.beginPath();
  ctx.moveTo(150,0); ctx.lineTo(150,300);
  ctx.moveTo(0,150); ctx.lineTo(300,150);
  ctx.stroke();
}

function drawAngle(theta){
  ctx.clearRect(0,0,300,300);
  drawGrid();

  const rad = theta * Math.PI / 180;
  const cx=150, cy=150, r=100;

  ctx.strokeStyle="#00e5ff";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx + r*Math.cos(rad), cy - r*Math.sin(rad));
  ctx.stroke();

  const eksak = nilaiEksak(theta);

  if(eksak){
    sinVal.textContent = `sin(Î¸) = ${eksak.sin}`;
    cosVal.textContent = `cos(Î¸) = ${eksak.cos}`;
    tanVal.textContent = `tan(Î¸) = ${eksak.tan}`;
  }else{
    sinVal.textContent = `sin(Î¸) = ${Math.sin(rad).toFixed(3)}`;
    cosVal.textContent = `cos(Î¸) = ${Math.cos(rad).toFixed(3)}`;
    tanVal.textContent = `tan(Î¸) = ${Math.tan(rad).toFixed(3)}`;
  }
}

angle.addEventListener("input",()=>drawAngle(+angle.value));
drawAngle(0);


/* ======================
   KONFIGURASI UJIAN
====================== */
const sudutIstimewa = [0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330];
const fungsi = ["sin","cos","tan"];
const toleransi = 0.01;

let sesi = {
  nomor: 0,
  total: 20,
  benar: 0,
  soal: null,
  hasil: []
};

const acak = arr => arr[Math.floor(Math.random()*arr.length)];

/* ======================
   HITUNG NILAI
====================== */
function nilai(f,d){
  const r = d * Math.PI / 180;
  if(f==="sin") return Math.sin(r);
  if(f==="cos") return Math.cos(r);
  if(f==="tan") return Math.tan(r);
}

/* ======================
   NORMALISASI JAWABAN (SUPER AKURAT)
====================== */
function normalisasiUjian(input){
  if(!input) return NaN;

  let j = input
    .toLowerCase()

    // bersihkan spasi & minus aneh
    .replace(/\s+/g,"")
    .replace(/â€“|âˆ’/g,"-")

    // ubah âˆš(...)
    .replace(/âˆš\s*\(([^)]+)\)/g,"Math.sqrt($1)")

    // ubah âˆšangka
    .replace(/âˆš(\d+(\.\d+)?)/g,"Math.sqrt($1)")

    // pangkat
    .replace(/Â²/g,"**2")

    // bentuk 1/2âˆš3 â†’ (1/2)*âˆš3
    .replace(/(\d+)\/(\d+)(Math\.sqrt\([^)]+\))/g,"($1/$2)*$3")

    // bentuk âˆš3/2 â†’ (Math.sqrt(3))/2
    .replace(/(Math\.sqrt\([^)]+\))\/(\d+)/g,"($1)/$2")

    // bentuk 2âˆš3 â†’ 2*Math.sqrt(3)
    .replace(/(\d+)(Math\.sqrt)/g,"$1*$2")

    // implicit multiplication
    .replace(/(\))(\()/g,"$1*$2")
    .replace(/(\d)(\()/g,"$1*$2")
    .replace(/(\))(\d)/g,"$1*$2")

    // bentuk 1/4(âˆš6+âˆš2)
    .replace(/(\d+)\/(\d+)\(/g,"($1/$2)*(")

    // safety
    .replace(/\/(\d+)$/g,"/($1)");

  try{
    const val = Function(`"use strict"; return (${j})`)();
    return (typeof val === "number" && isFinite(val)) ? val : NaN;
  }catch{
    return NaN;
  }
}

function buatTerm(){
  let f, d;

  do{
    f = acak(["sin","cos","tan"]);
    d = acak(sudutIstimewa);
  }while(f==="tan" && d%180===90);

  // mode term (tidak boleh koef + kuadrat barengan)
  const mode = Math.random();

  let koef = 1;
  let kuadrat = false;

  if(mode < 0.33){
    koef = acak([2,3]);           // MODE KOEFISIEN
  }else if(mode < 0.66){
    kuadrat = true;               // MODE KUADRAT
  }
  // sisanya MODE NORMAL

  // NOTASI TEKS
  let teks = "";

  if(koef !== 1) teks += koef;
  teks += kuadrat ? `${f}Â² ${d}Â°` : `${f} ${d}Â°`;

  //  NILAI NUMERIK
  let nilaiTerm = nilai(f,d);
  if(kuadrat) nilaiTerm = nilaiTerm ** 2;
  nilaiTerm *= koef;

  return { teks, nilai: nilaiTerm };
}



/* ======================
   SOAL DASAR
====================== */
function soalDasar(){
  let f, d;
  do{
    f = acak(fungsi);
    d = acak(sudutIstimewa);
  }while(f==="tan" && d%180===90);

  return {
    teks:`${f} ${d}Â°`,
    jawaban:nilai(f,d)
  };
}

/* ======================
   SOAL EKSTREM
====================== */
function soalEkstrem(){
  const t1 = buatTerm();
  const t2 = buatTerm();
  const op = acak([" + "," - "," Â· "]);

  let teks = `${t1.teks}${op}${t2.teks}`;
  let jawaban =
    op===" + "? t1.nilai+t2.nilai :
    op===" - "? t1.nilai-t2.nilai :
    t1.nilai*t2.nilai;

  if(Math.random()<0.3){
    const t3 = buatTerm();
    const op2 = acak([" + "," - "]);
    teks += `${op2}${t3.teks}`;
    jawaban += op2===" + " ? t3.nilai : -t3.nilai;
  }

  return { teks, jawaban };
}

/* ======================
   ALUR UJIAN
====================== */
function mulaiUjian(){
  sesi = { nomor:0, total:20, benar:0, soal:null, hasil:[] };
  ujianHasil.innerHTML="";
  nextSoal();
}

function nextSoal(){
  if(sesi.nomor>=sesi.total){
    selesaiUjian();
    return;
  }

  sesi.soal = Math.random()<0.5 ? soalDasar() : soalEkstrem();
  sesi.nomor++;

  ujianSoal.textContent =
    `Soal ${sesi.nomor}/${sesi.total}: ${sesi.soal.teks}`;

  ujianInfo.textContent="";
  ujianJawaban.value="";
}

/* ======================
   JAWAB & KOREKSI
====================== */

function jawabUjian(){
  if(!sesi.soal) return;

  const user = normalisasiUjian(ujianJawaban.value);
  const benar = sesi.soal.jawaban;

  let status =
    !isNaN(user) &&
    Math.abs(user - benar) <= toleransi;

  if(status) sesi.benar++;

  sesi.hasil.push({
    soal: sesi.soal.teks,
    status
  });

  ujianInfo.textContent = status ? "âœ… Benar" : "âŒ Salah";
  ujianInfo.style.color = status ? "lime" : "red";

  setTimeout(nextSoal, 700);
}


/* ======================
   SELESAI UJIAN
====================== */
function selesaiUjian(){
  const nilaiAkhir = Math.round((sesi.benar/sesi.total)*100);

  let level =
    nilaiAkhir>=90 ? "ğŸ† MASTER" :
    nilaiAkhir>=75 ? "ğŸ”¥ ADVANCED" :
    nilaiAkhir>=60 ? "ğŸ™‚ INTERMEDIATE" :
    "ğŸ“˜ BEGINNER";

  ujianSoal.textContent="Ujian Selesai!";
  ujianInfo.innerHTML=`
    Skor: <b>${sesi.benar}/${sesi.total}</b><br>
    Nilai: <b>${nilaiAkhir}</b><br>
    Level: <b>${level}</b>
  `;

  ujianHasil.innerHTML="<hr><b>ğŸ“‹ Rekap Jawaban</b><br>";
  sesi.hasil.forEach((h,i)=>{
    ujianHasil.innerHTML+=`${i+1}. ${h.soal} â†’ ${h.status?"âœ…":"âŒ"}<br>`;
  });
}
  
</script>
</body>
</html>
